/*
* gCalEvents, A Google Calendar Events plugin for jQuery
* By: Michael McGlynn, http://www.reignitioninc.com
* Version: 1.0.4
* Updated: April 23rd, 2014
*
* Dual licensed under the MIT and GPL licenses.
* http://en.wikipedia.org/wiki/MIT_License
* http://en.wikipedia.org/wiki/GNU_General_Public_License
*/

(function(e) {
    e.fn.gCalEvents = function(t) {
        function u(e, t) {
            var n, r, i, s;
            var o = {
                months: {
                    full: ["", "January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"],
                    "short": ["", "Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"]
                },
                days: {
                    full: ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"],
                    "short": ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"]
                }
            };
            if (e.length > 10) {
                r = /(\d+)\-(\d+)\-(\d+)T(\d+)\:(\d+)/.exec(e);
                i = r[4] < 12;
                s = i ? parseInt(r[4]) + ":" + r[5] + " AM" : r[4] - 12 + ":" + r[5] + " PM";
                if (s.indexOf("0") == 0) {
                    if (s.indexOf(":00") == 1) {
                        if (s.indexOf("AM") == 5) {
                            s = "MIDNIGHT"
                        } else {
                            s = "NOON"
                        }
                    } else {
                        s = s.replace("0:", "12:")
                    }
                }
            } else {
                r = /(\d+)\-(\d+)\-(\d+)/.exec(e);
                s = "Time not present in feed."
            }
            year = parseInt(r[1]);
            month = parseInt(r[2]);
            dayNum = parseInt(r[3]);
            var u = new Date(year, month - 1, dayNum);
            switch (t) {
                case "ShortTime":
                    n = s;
                    break;
                case "ShortDate":
                    n = month + "/" + dayNum + "/" + year;
                    break;
                case "LongDate":
                    n = o.days.full[u.getDay()] + " " + o.months.full[month] + " " + dayNum + ", " + year;
                    break;
                case "LongDate+ShortTime":
                    n = o.days.full[u.getDay()] + " " + o.months.full[month] + " " + dayNum + ", " + year + " " + s;
                    break;
                case "ShortDate+ShortTime":
                    n = month + "/" + dayNum + "/" + year + " " + s;
                    break;
                case "DayMonth":
                    n = o.days.short[u.getDay()] + ", " + o.months.full[month] + " " + dayNum;
                    break;
                case "MonthDay":
                    n = o.months.full[month] + " " + dayNum;
                    break;
                case "YearMonth":
                    n = o.months.full[month] + " " + year;
                    break;
                default:
                    n = o.days.full[u.getDay()] + " " + o.months.short[month] + " " + dayNum + ", " + year + " " + s
            }
            return n
        }
        var n = e.extend({
            CalendarId: "en.judaism%23holiday%40group.v.calendar.google.com",
            DateFormat: "DayMonth",
            ShowTimes: false,
            ShowDescription: false,
            NoEventsLang: "There are currently no events scheduled.",
            TimeZone: "America/New_York",
            FutureEvents: true,
            MaxEvents: 100
        }, t);
        var r = e(this).attr("id"),
            i = "",
            s = "starttime";
        var o = "http://www.google.com/calendar/feeds/" + n.CalendarId.trim() + "/public/full?orderby=" + s + "&sortorder=a&futureevents=" + n.FutureEvents + "&max-results=" + n.MaxEvents + "&ctz=" + n.TimeZone.trim() + "&alt=json";
        console.log(o);
        e.ajax({
            url: o,
            dataType: "json",
            success: function(t) {
                e.each(t.feed.entry, function(e, t) {
                    i += '<div class="entry">';
                    i += "<h3>" + u(t.gd$when[0].startTime, n.DateFormat.trim()) + "</h3>";
                    i += "<h2>" + t.title.$t + "</h2>";
                    n.ShowTimes ? i += "<h3>" + u(t.gd$when[0].startTime, "ShortTime") + " - " + u(t.gd$when[0].endTime, "ShortTime") + "</h3>" : null;
                    n.ShowDescription ? i += '<div class="desc">' + t.content.$t + "</div>" : null;
                    t.gd$where[0].valueString ? i += '<p class="location"><span>Location: </span><span>' + t.gd$where[0].valueString + "</span></p>" : null;
                    i += "</div>"
                });
                e("#" + r).append(i)
            },
            error: function(t) {
                i += '<div class="entry"><p>' + n.NoEventsLang + "</p></div>";
                e("#" + r).append(i)
            }
        })
    }
})(jQuery)